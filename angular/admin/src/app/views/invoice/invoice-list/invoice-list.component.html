<div class="container mt-4">
  <!-- Header + Filters -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Invoice List</h4>
    <div class="d-flex gap-2">
      <input type="text" class="form-control form-control-sm" placeholder="🔍 Search by Client/Invoice No."
             [(ngModel)]="searchText" (input)="loadInvoices()" />

      <input type="date" class="form-control form-control-sm" [(ngModel)]="startDate" (change)="loadInvoices()" />
      <input type="date" class="form-control form-control-sm" [(ngModel)]="endDate" (change)="loadInvoices()" />

      <select class="form-select form-select-sm" [(ngModel)]="filterStatus" (change)="loadInvoices()">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Paid">Paid</option>
        <option value="Deleted">Deleted</option>
      </select>

      <button class="btn btn-sm btn-primary" (click)="downloadTablePDF()">
        <i class="bi bi-file-earmark-arrow-down"></i> Export List
      </button>
    </div>
  </div>

  <!-- Invoice Table -->
  <div #tableContent>
    <table class="table table-bordered table-striped table-hover">
  <thead class="table-light">
    <tr>
      <th>Client Name</th>
      <th>Invoice No.</th>
      <th>Generated Date</th>
      <th>Due Date</th>
      <th>Status</th>
      <th>Remarks</th>
      <th style="width:150px;">Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let inv of invoices">
      <td>{{ inv.clientName }}</td>
      <td>{{ inv.invoiceNo }}</td>
      <td>{{ inv.date | date:'dd/MM/yyyy' }}</td>
      <td>{{ inv.dueDate | date:'dd/MM/yyyy' }}</td>
      <td>
        <!-- ✅ Status Dropdown -->
        <select class="form-select form-select-sm"
                [(ngModel)]="inv.status"
                (change)="updateInvoiceStatus(inv)">
          <option value="Pending">Pending</option>
          <option value="Paid">Paid</option>
          <option value="Deleted">Deleted</option>
        </select>
      </td>
      <td>{{ inv.remarks || '-' }}</td>
      <td>
        <!-- ✅ View navigates to edit route -->
       <button class="btn btn-sm btn-info me-1" (click)="viewInvoice(inv._id)">
  <i class="fas fa-eye"></i>
</button>
<button class="btn btn-sm btn-danger me-1" (click)="deleteInvoice(inv._id)">
  <i class="fas fa-trash"></i>
</button>
<button class="btn btn-sm btn-secondary" (click)="downloadInvoicePDF(inv)">
  <i class="fas fa-download"></i>
</button>

      </td>
    </tr>
  </tbody>
</table>

  </div>

  <!-- Pagination -->
  <nav *ngIf="count > limit">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page === 1">
        <a class="page-link" (click)="changePage(page-1)">Previous</a>
      </li>
      <li class="page-item" *ngFor="let p of [].constructor(totalPages); let i = index"
          [class.active]="page === i+1">
        <a class="page-link" (click)="changePage(i+1)">{{ i+1 }}</a>
      </li>
      <li class="page-item" [class.disabled]="page === totalPages">
        <a class="page-link" (click)="changePage(page+1)">Next</a>
      </li>
    </ul>
  </nav>
</div>
