<div class="product_search_page mt-3 pt_110">
  <section class="product-list-page">
    <div class="container-fluid">
      <span class="product_banner"><img src="{{env}}{{allCategory_banner}}" alt=""></span>
      <div class="product-filter-sec active" id="product-filter-sec">
        <div class="category-menu">
          <div class="category-head">
            <h2><i class="fa fa-shopping-bag"></i>&nbsp;Shop by Department</h2>
          </div>
          <div class="categorys-menus">
            <div class="accordion product_filter" id="accordionExample"
              *ngIf="sub_list && sub_list.mainCat && sub_list.mainCat.length > 0">

              <div class="accordion-item" *ngFor="let main_cat of sub_list.mainCat;">
                <h2 class="accordion-header" [ngClass]="{'active': categoryStates[main_cat._id]}" id="headingOne">
                  <button class="accordion-button p-0" type="button" data-bs-toggle="collapse"
                    [attr.aria-expanded]="categoryStates[main_cat._id] ? 'true' : 'false'"
                    [attr.aria-controls]="'collapse' + main_cat._id"
                    (click)="selectMainCategory(main_cat._id, main_cat.slug)">
                    <div class="category-li">
                      <div class="category_head">
                        <img class="category_parent_img" src="{{apiUrl + main_cat.iconimg}}" alt="" />
                      </div>
                      <span>{{main_cat.rcatname}}</span>
                    </div>
                  </button>
                </h2>

                <div [id]="'collapse' + main_cat._id" class="accordion-collapse collapse"
                  [ngClass]="{'show': categoryStates[main_cat._id]}" aria-labelledby="headingOne"
                  data-bs-parent="#accordionExample" *ngIf="checkobx[main_cat._id] == true">

                  <ng-container *ngIf="sub_list[main_cat._id] && sub_list[main_cat._id].length > 0">
                    <div class="accordion-body" *ngFor="let scat of sub_list[main_cat._id]; let j = index">
                      <div class="sub_category_list" [ngClass]="{'active': isActive(scat.slug)}">
                        <img src="{{apiUrl + scat.img}}" alt="" />
                        <input type="checkbox" [checked]="category.indexOf(scat._id) !== -1"
                          (change)="subCategorySelect(scat._id, scat.slug, j, main_cat._id, '')" name="scat{{j}}"
                          id="scat{{j}}">
                        <span class="checkmark">{{scat.scatname}}</span>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="filter-list">
          <!-- <span class="cat-banner"><img src="assets/image/pillais/catagories-banner.jpg" alt=""></span> -->
          <span class="cat-banner"><img src="{{env}}{{allCategory_banner}}" alt=""></span>
          <div class="product_pagination">
            <div class="filter-result box-scroll">
              <div class="card_box" *ngFor="let item of productList">
                <span class="product_images">
                  <picture *ngIf="item.avatar" (click)="productDetails(item.slug,item._id,item.rcat_id,item.scat_id)">
                    <source *ngIf="item.avatar?.webpImg" [srcset]="env + item.avatar?.webpImg" type="image/webp">
                    <img [src]="env + (item.avatar?.fallback || item.avatar)"
                      onerror="this.src='assets/image/no_img.png'" alt="Trade Mark Image">
                    <!-- <span class="off_percentage"
                      *ngIf="item && item.selectedPriceDetail && item.selectedPriceDetail.mprice != (undefined || null || '') &&  item.selectedPriceDetail.mprice">({{
                      (( item?.selectedPriceDetail?.mprice - item?.selectedPriceDetail?.sprice) /
                      item?.selectedPriceDetail?.mprice * 100) | number : '1.0-0' }}% Off)</span> -->

                    <span class="off_percentage" *ngIf="
                    item && 
                    item.selectedPriceDetail &&
                    item.selectedPriceDetail.mprice != (undefined || null || '') &&
                    item.selectedPriceDetail.sprice != (undefined || null || '') &&
                    item.selectedPriceDetail.mprice > 0 &&
                    (item.selectedPriceDetail.mprice - item.selectedPriceDetail.sprice) > 0
                  ">
                      ({{
                      ((item.selectedPriceDetail.mprice - item.selectedPriceDetail.sprice) /
                      item.selectedPriceDetail.mprice * 100) | number : '1.0-2'
                      }}% Off)
                    </span>
                  </picture>
                </span>
                <div class="card_box_details">
                  <p class="cart_cnt" (click)="productDetails(item.slug,item.product_id,item.rcategory,item.scategory)">
                    <span>{{item.name}}</span>
                  </p>
                  <div *ngIf="item.selectedPriceDetail">

                    <p class="price 1" *ngIf="item.offer_status == 0">
                      <span class="" *ngIf="item.base_price > item.sale_price">
                        ₹ {{(item && item.selectedPriceDetail && item.selectedPriceDetail.mprice != (undefined || null
                        || '') && item.selectedPriceDetail.mprice ? item.selectedPriceDetail.mprice : 0) | number}}
                      </span>&nbsp;
                      <span>
                        ₹ {{item && item.selectedPriceDetail && item.selectedPriceDetail.sprice != (undefined || null ||
                        '') ? item.selectedPriceDetail.sprice : 0 | number}}
                      </span>
                    </p>
                  </div>
                  <!-- <p class="price" *ngIf="item.offer_status == 1">₹ {{item.offer_sale | number}} <i
                      class="fst-normal text-decoration-line-through" *ngIf="item.offer_base > item.offer_sale">₹
                      {{item.offer_base | number}}</i>
                  </p> -->
                  <!-- <p class="deal-outofstock"><span *ngIf="item.size_status == 2 && !item.quantity"><i></i> Out
                      of
                      stock</span> </p> -->

                  <div *ngIf="settings.review_rating && item.total_rating_users>0 && item.rating" class="review_rating">
                    <div class="_3LWZlK">{{item.rating ? item.rating : 0}}&nbsp;
                      <i class="fa fa-star" aria-hidden="true"></i>
                    </div>&nbsp;|
                    <label>{{item.total_rating_users ? (item.total_rating_users | usersCount) : 0}}</label>
                  </div>
                  <!-- <button *ngIf="cart_details.indexOf(item['_id'])!=-1 && item.size_status == 2 "
                    [routerLink]="['/cart']">
                    Go To Cart <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </button>
                  <button *ngIf="cart_details.indexOf(item['_id'])==-1 && item.size_status == 2 && item.quantity > 0 "
                    (click)="preAddCart(item,'add')">
                    Add To Cart <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </button>
                  <button *ngIf="cart_details.indexOf(item['_id'])!=-1 && item.size_status == 1 "
                    [routerLink]="['/cart']">
                    Go To Cart <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </button>
                  <button *ngIf="cart_details.indexOf(item['_id'])==-1 && item.size_status == 1 "
                    (click)="productDetails(item.slug,item._id,item.rcat_id,item.scat_id)">
                    Add To Cart <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </button> -->

                  <!-- <a _ngcontent-ng-c3659046559="" class="p-add-cart"><img _ngcontent-ng-c3659046559=""
                      src="../../../assets/image/pillais/cart.png" alt=""></a> -->
                  <!-- <a class="p-add-cart" *ngIf="cartLength==0"
											(click)="preAddCart(item, 'add')">
											<img src="../../../assets/image/pillais/cart.png" alt="" />
										</a> -->
                  <ul l class="kg_gram_l">
                    <li *ngFor="let price of item.price_details">
                      <input type="radio" name="p-q-{{item._id}}" [value]="price" [(ngModel)]="item.selectedPriceDetail"
                        (ngModelChange)="onPriceDetailChange(item,$event)">
                      <p>{{ price.attributes[0]?.chaild_name }}</p>
                    </li>
                  </ul>
                  <div class="v-add qty-sec cart_add_to_cart">
                    <!-- <p class="offer_precentage">Save: <span>₹24 (9% off!)</span></p> -->
                    <!-- <p class="offer_precentage">Save: <span>{{currency_symbol ? currency_symbol : '₹'}}{{ ((item?.selectedPriceDetail?.mprice || 0) - (item?.selectedPriceDetail?.sprice || 0)) | number }} ({{ ((item?.selectedPriceDetail?.mprice - item?.selectedPriceDetail?.sprice) / item?.selectedPriceDetail?.mprice * 100) | number : '1.0-0' }}% off!)</span></p> -->

                    <!-- <p class="offer_precentage">Save: <span>{{currency_symbol ? currency_symbol : '₹'}}{{((item && item.selectedPriceDetail && item.selectedPriceDetail.mprice != (undefined || null || '') && item.selectedPriceDetail.mprice ? item.selectedPriceDetail.mprice : 0) | number) - (item && item.selectedPriceDetail && item.selectedPriceDetail.sprice != (undefined || null || '') ? item.selectedPriceDetail.sprice : 0 | number)}} (9% off!)</span></p> -->
                    <!-- <p class="offer_precentage">Save: <span>{{currency_symbol ? currency_symbol : '₹'}}{{(item.selectedPriceDetail && item.selectedPriceDetail.mprice && item.selectedPriceDetail.mprice != (undefined || null || '') ? item.selectedPriceDetail.mprice : 0) - (item && item.selectedPriceDetail && item.selectedPriceDetail.sprice != (undefined || null || '') && item.selectedPriceDetail.sprice ? item.selectedPriceDetail.sprice : 0)}} ({{ (((item.selectedPriceDetail && item.selectedPriceDetail.mprice != (undefined || null || '') && item.selectedPriceDetail.mprice ? item.selectedPriceDetail.mprice : 0) - (item && item.selectedPriceDetail && item.selectedPriceDetail.sprice != (undefined || null || '') && item.selectedPriceDetail.sprice ? item.selectedPriceDetail.sprice : 0)) / item.selectedPriceDetail.mprice * 100) | number : '1.0-0' }}% off!)</span></p> -->
                    <a class="p-add-cart" *ngIf="cartLength==0" (click)="preAddCart(item, 'add')">
                      <img src="../../../assets/image/pillais/cart.png" alt="" />
                    </a>

                    <!-- <a class="p-add-cart" *ngIf="cartLength==0" (click)="preAddCart(item, 'add')">
                    <img src="../../../assets/image/pillais/cart.png" alt="" />
                  </a> -->

                    <div *ngFor="let i of item.price_details">
                      <div *ngFor="let rem of unmatchedObjects">

                        <div *ngIf=" item._id===rem._id 
                       && i.attributes[0]?.chaild_id == rem.price_details.attributes[0]?.chaild_id 
                      && i.attributes[0]?.chaild_id==item.selectedPriceDetail.attributes[0]?.chaild_id
                       && rem.showAddToCartButton 
                      && cartLength>0 ">
                          <!-- <button
                        (click)="preAddCartBtn(item, 'add',rem._id,rem.price_details.attributes[0].chaild_id )">
                        ADD TO CART
                      </button> -->
                          <a class="p-add-cart"
                            (click)="preAddCartBtn(item, 'add',rem._id,rem.price_details.attributes[0].chaild_id )">
                            <img src="../../../assets/image/pillais/cart.png" alt="" />
                          </a>
                        </div>
                      </div>
                    </div>
                    <!-- <div *ngFor="let items of cartDetails.cart_details; let i=index">
                        <div class="p-dec-qty " *ngIf="item._id === cartDetails.cart_details[i].id 
                      && item.selectedPriceDetail.attributes[0].chaild_id == items.variations[0][0].chaild_id 
                       ">
                          <div class="p-qty-form minus_plus_section">
                            <button class="minus_input_plus"
                              *ngIf="items.quantity==1"
                              (click)="removeFoodFromCart(items)">-</button>
                            <button class="minus_input_plus"
                              *ngIf="items.quantity>1"
                              (click)="changeCart(items, 'decreement')">-</button>
                            <input class="minus_input_plus" type="text"
                              [(ngModel)]="items.quantity" readonly />
                            <button class="minus_input_plus"
                              (click)="changeCart(items, 'increement')">+</button>
                          </div>
                        </div>
                      </div> -->

                    <div *ngFor="let items of cartDetails?.cart_details; let i=index">

                      <div class="p-dec-qty " *ngIf="item._id === cartDetails.cart_details[i].id 
                          && item.selectedPriceDetail.attributes[0].chaild_id == items.variations[0][0].chaild_id 
                           ">
                        <div class="p-qty-form minus_plus_section">
                          <button class="minus_input_plus" *ngIf="items.quantity==1"
                            (click)="removeFoodFromCart(items)">-</button>
                          <button class="minus_input_plus" *ngIf="items.quantity>1"
                            (click)="changeCart(items, 'decreement')">-</button>
                          <input class="minus_input_plus" type="text" [(ngModel)]="items.quantity" readonly />
                          <button class="minus_input_plus" (click)="changeCart(items, 'increement')">+</button>
                        </div>
                      </div>
                    </div>
                  </div>


                </div>
                <!-- <i class="fa-regular fa-heart"></i>
                <i class="fa-solid fa-heart"></i> -->
                <p class="like" *ngIf="!item.favourite"
                  (click)="addFavourite(item._id,item.selectedPriceDetail.attributes[0].chaild_id)">
                  <i class="fa-regular fa-heart" aria-hidden="true"></i>
                </p>
                <p class="like" *ngIf="item.favourite"
                  (click)="addFavourite(item._id,item.selectedPriceDetail.attributes[0].chaild_id)">
                  <i class="fa-solid fa-heart" aria-hidden="true"></i>
                </p>

              </div>


              <div class="no-order d-flex flex-wrap justify-content-center"
                *ngIf="showproduct && productList.length == 0">
                <span>
                  <img src="assets/image/no-product.png" alt="" width="100%" height="100%">
                </span>
                <p class="empty-p mt-2"><span>Product is not available</span></p>
              </div>
            </div>
          </div>
          <div class="pagination-sec" *ngIf="productList.length != 0">
            <nav aria-label="...">
              <ul class="pagination">
                <li class="page-item" [ngClass]="{'disabled': currentPage === 1}">
                  <a class="page-link" (click)="setPage(currentPage - 1)" aria-label="Previous">
                    Previous
                  </a>
                </li>
                <li class="page-item" *ngFor="let page of getVisiblePageNumbers()"
                  [ngClass]="{'active': currentPage === page}">
                  <a class="page-link" (click)="setPage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [ngClass]="{'disabled': currentPage === totalPages}">
                  <a class="page-link" (click)="setPage(currentPage + 1)" aria-label="Next">
                    Next
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </section>
  <ng-template #loginPopup>
    <app-login [modalRef]="modalRef"> </app-login>
  </ng-template>
  <ng-template #subCategoryTemplate let-detailObj>
    <li *ngFor="let subcat of sub_list[detailObj.parentId]; let k=index">
      <input type="checkbox" [checked]="category.indexOf(subcat._id) != -1"
        (change)="subCategorySelect(subcat._id,subcat.slug,detailObj.indx,detailObj.parentId,detailObj.grandParentId)"><span
        style="position: relative;
    left: 10px;">{{subcat.scatname}}</span>
      <ul class="submenu" *ngIf="sub_list[subcat._id] && sub_list[subcat._id].length > 0 ">
        <ng-container
          *ngTemplateOutlet="subCategoryTemplate; context:{  $implicit: {parentId:subcat._id, grandParentId: detailObj.parentId} }">
        </ng-container>
      </ul>
    </li>
  </ng-template>
</div>